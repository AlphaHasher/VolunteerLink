<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />
    <title>Volunteer Link</title>
    <link rel="stylesheet" href="./global.css" />
    <link rel="stylesheet" href="./index-test.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" />
</head>
<body>
    <div class="events-page">
        <header class="nav-bar1">
          <div class="nav-bar-background1"></div>
          <img
            class="sac-state-logo1"
            loading="lazy"
            alt=""
            src="./public/sac-state-logo@2x.png"
          />

          <nav class="branching-logic">
            <nav class="apply-group">
              <h3 class="apply1">APPLY</h3>
              <h3 class="experience1">EXPERIENCE</h3>
              <h3 class="give1">GIVE</h3>
            </nav>
          </nav>
        </header>
        <section class="input-provider">
          <div class="spotlight-element1">
            <div class="spotlight-background1"></div>
            <h1 class="volunteer-link1">Volunteer Link</h1>
            <div class="condition-checker">
              <button class="login-button" id="loginButton">
                <div class="login-button-child"></div>
                <b class="login">Login</b>
              </button>
            </div>
          </div>
        </section>
    <h1>Event List</h1>
    <div class="event-list" id="event-list"></div>

    <script>
      // Function to fetch events from backend and display them
      async function fetchAndDisplayEvents() {
          try {
              const response = await fetch('/events');
              let events = await response.json();

              // Sort events by start date
              events.sort((a, b) => {
                  const startDateA = new Date(a.startDate);
                  const startDateB = new Date(b.startDate);
                  return startDateA - startDateB;
              });

              // Clear previous list items
              const eventList = document.getElementById('event-list');
              eventList.innerHTML = '';

              // Display each event in the sorted list
              events.forEach(event => {
                  const eventName = event.eventName;
                  const eventDescription = event.eventDescription;
                  const startDate = event.startDate ? new Date(event.startDate).toLocaleDateString('en-US', { year: 'numeric', month: '2-digit', day: '2-digit' }) : null;
                  const startTime = event.startDate ? `${new Date(event.startDate).getHours()}:${String(new Date(event.startDate).getMinutes()).padStart(2, '0')}` : null;
                  const endDate = event.endDate ? new Date(event.endDate).toLocaleDateString('en-US', { year: 'numeric', month: '2-digit', day: '2-digit' }) : null;
                  const endTime = event.endDate ? `${new Date(event.endDate).getHours()}:${String(new Date(event.endDate).getMinutes()).padStart(2, '0')}` : null;
                  const volunteersNeeded = event.volunteersNeeded;

                  const eventBox = document.createElement('div');
                  eventBox.classList.add('event-box');
                  eventBox.innerHTML = `
                      <div class="event-name">${eventName}</div>
                      <div class="event-description">${eventDescription}</div>
                      <div class="event-date">Start Date: ${startDate} | Start Time: ${startTime} | End Date: ${endDate} | End Time: ${endTime}</div>
                      <div class="volunteers-needed">Volunteers Needed: ${volunteersNeeded}</div>
                  `;

                  // Check and add tags if they exist
                  if(event.tags && event.tags.length > 0) {
                      const tagsDiv = document.createElement('div');
                      tagsDiv.classList.add('event-tags');
                      event.tags.forEach(tag => {
                          const tagSpan = document.createElement('span');
                          tagSpan.classList.add('event-tag');
                          tagSpan.textContent = tag;
                          tagsDiv.appendChild(tagSpan);
                      });
                      eventBox.appendChild(tagsDiv);
                  }

                  eventList.appendChild(eventBox);
              });
          } catch (error) {
              console.error('Error fetching events:', error);
          }
      }

      // Call the function when the page loads
      fetchAndDisplayEvents();
  </script>

</body>
</html>