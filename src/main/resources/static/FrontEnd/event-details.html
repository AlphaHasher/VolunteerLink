<!--This file will be the file to show further details about each even from the event list
Rushabh 'st est code, still building the page-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volunteer Link</title>
    <link rel="icon" type="image/x-icon" href="./public/volunteer-management-logo@2x.png" />
    <link rel="stylesheet" href="./global.css" />
    <link rel="stylesheet" href="./index-test.css" />
    <link rel="stylesheet" href="./index.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" />
    <title>Event Details</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
        }
        .event-details {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .event-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .event-description {
            margin-bottom: 10px;
        }
        .event-info {
            margin-bottom: 10px;
        }
        .back-btn {
            display: block;
            margin-top: 20px;
            text-align: center;
        }
        .back-btn a {
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
        }
        .event-details-container{
            z-index: 1;
        }
        .register-btn {
            display: block;
            margin-top: 20px;
            text-align: center;
        }
        .register-btn button {
            padding: 10px 20px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <header class="nav-bar1">
        <div class="nav-bar-background1"></div>
        <img class="sac-state-logo1" loading="lazy" alt="" src="./public/sac-state-logo@2x.png" />
        <nav class="apply-group">
            <a href="https://www.csus.edu/apply/" class="apply1">APPLY</a>
            <a href="https://www.csus.edu/experience/" class="experience1">EXPERIENCE</a>
            <a href="https://www.csus.edu/giving/" class="give1">GIVE</a>
        </nav>
    </header>
    <section class="input-provider">
        <div class="spotlight-element1">
            <div class="spotlight-background1"></div>
            <h1 class="event-details-header">Event Details</h1>
            <div class="condition-checker">
                <button class="login-button" id="loginButton">
                    <div class="login-button-child"></div>
                    <b class="login">Login</b>
                </button>
            </div>
        </div>
    </section>
    <div class="event-details" id="event-details-container"></div>

    <script>
        var loginButton = document.getElementById("loginButton");
        if (loginButton) {
            loginButton.addEventListener("click", function (e) {
                window.location.href = "./login-page.html";
            });
        }

        var loginButton = document.getElementById("loginButton");
        if (loginButton) {
            loginButton.addEventListener("click", function (e) {
                window.location.href = "./login-page.html";
            });
        }

        // Add the fetchAndDisplayEventDetails function here
        async function fetchAndDisplayEventDetails(eventId) {
            try {
                const response = await fetch(`/events/${eventId}`); // Assuming the backend endpoint to fetch event details is '/events/{eventId}'
                const event = await response.json();

                const eventName = event.eventName;
                const eventDescription = event.eventDescription;
                const startDate = event.startDate ? new Date(event.startDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : null;
                const startTime = event.startDate ? `${new Date(event.startDate).getHours()}:${String(new Date(event.startDate).getMinutes()).padStart(2, '0')}` : null;
                const endDate = event.endDate ? new Date(event.endDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : null;
                const endTime = event.endDate ? `${new Date(event.endDate).getHours()}:${String(new Date(event.endDate).getMinutes()).padStart(2, '0')}` : null;
                const volunteersNeeded = event.volunteersNeeded;

                const eventDetailsContainer = document.getElementById('event-details-container');
                //takes in the session ID from java file
                //Checks to see if user is logged in already or not
                const sessionResponse = await fetch("/sessionId");
                const sessionData = await sessionResponse.json();
                const userId = sessionData.userId;

                if (!userId) {
                    // User is not logged in, redirect to login page
                    eventDetailsContainer.innerHTML = `
                        <div class="event-name">${eventName}</div>
                        <div class="event-description">${eventDescription}</div>
                        <div class="event-info">
                            <strong>Start Date:</strong> ${startDate}<br>
                            <strong>End Date:</strong> ${endDate}<br>
                            <strong>Start Time:</strong> ${startTime}<br>
                            <strong>End Time:</strong> ${endTime}<br>
                            <strong>Volunteers Needed:</strong> ${volunteersNeeded}
                        </div>
                        <div class="register-btn">
                            <button onclick="redirectToLogin()">Register</button>
                        </div>
                        <div class="back-btn">
                            <a href="javascript:history.back()">Back to Events</a>
                        </div>
                    `;
                } else {
                    // User is logged in, redirect to index.html (placeholder for now)
                    eventDetailsContainer.innerHTML = `
                        <div class="event-name">${eventName}</div>
                        <div class="event-description">${eventDescription}</div>
                        <div class="event-info">
                            <strong>Start Date:</strong> ${startDate}<br>
                            <strong>End Date:</strong> ${endDate}<br>
                            <strong>Start Time:</strong> ${startTime}<br>
                            <strong>End Time:</strong> ${endTime}<br>
                            <strong>Volunteers Needed:</strong> ${volunteersNeeded}
                        </div>
                        <div class="register-btn">
                            <button onclick="redirectToIndex()">Register</button>
                        </div>
                        <div class="back-btn">
                            <a href="javascript:history.back()">Back to Events</a>
                        </div>
                    `;
            }
            } catch (error) {
                console.error('Error fetching event details:', error);
            }
        }

        //function to redict to login page
        function redirectToLogin() {
            window.location.href = "./login-page.html";
        }

        //function to proceed to register page (function name is different temporarily, will change when register page works)
        function redirectToIndex() {
            window.location.href = "./index.html";
        }

        // Call the fetchAndDisplayEventDetails function with the eventId parameter
        const urlParams = new URLSearchParams(window.location.search);
        const eventId = urlParams.get('eventId');
        fetchAndDisplayEventDetails(eventId);
    </script>
</body>
</html>
