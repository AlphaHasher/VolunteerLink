<!--This site is what the user will see when they open it for details
Site will show more details about particular event
User will be able to register for that event as well
Assuming we can get it to work-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Details</title>
    <link rel="icon" type="image/x-icon" href="./public/volunteer-management-logo@2x.png" />
    <link rel="stylesheet" href="./global.css" />
    <link rel="stylesheet" href="./index.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
        }
        .event-details {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .event-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .event-description {
            margin-bottom: 10px;
        }
        .event-info {
            margin-bottom: 10px;
        }
        .back-btn {
            display: block;
            margin-top: 20px;
            text-align: center;
        }
        .back-btn a {
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
        }
        .event-details-container{
            z-index: 1;
        }
        .register-btn {
            display: block;
            margin-top: 20px;
            text-align: center;
        }
        .register-btn button {
            padding: 10px 20px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .event-role {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <header class="nav-bar1">
        <div class="nav-bar-background1"></div>
        <img class="sac-state-logo1" loading="lazy" alt="" src="./public/sac-state-logo@2x.png" />
        <nav class="apply-group">
            <a href="https://www.csus.edu/apply/" class="apply1">APPLY</a>
            <a href="https://www.csus.edu/experience/" class="experience1">EXPERIENCE</a>
            <a href="https://www.csus.edu/giving/" class="give1">GIVE</a>
        </nav>
    </header>
    <section class="input-provider">
        <div class="spotlight-element1">
            <div class="spotlight-background1"></div>
            <h1 class="event-details-header">Event Details</h1>
            <div class="condition-checker">
                <button class="login-button" id="loginButton">
                    <div class="login-button-child"></div>
                    <b class="login">Login</b>
                </button>
            </div>
        </div>
    </section>
    <div class="event-details" id="event-details-container"></div>

    <script>
        var loginButton = document.getElementById("loginButton");
        if (loginButton) {
            loginButton.addEventListener("click", function (e) {
                window.location.href = "./login-page.html";
            });
        }

        async function fetchAndDisplayEventDetails() {
        try {
            const urlParams = new URLSearchParams(window.location.search);
            const eventId = urlParams.get('eventId');
            const response = await fetch(`/events/${eventId}`);
            const event = await response.json();

            const eventDetailsContainer = document.getElementById('event-details-container');
            eventDetailsContainer.innerHTML = `
                <div class="event-name">${event.eventName}</div>
                <div class="event-description">${event.eventDescription}</div>
                <div class="event-info">
                    <strong>Start Date:</strong> ${new Date(event.startDate).toLocaleDateString('en-US')}<br>
                    <strong>End Date:</strong> ${new Date(event.endDate).toLocaleDateString('en-US')}<br>
                    <strong>Start Time:</strong> ${new Date(event.startDate).toLocaleTimeString('en-US')}<br>
                    <strong>End Time:</strong> ${new Date(event.endDate).toLocaleTimeString('en-US')}<br>
                    <strong>Volunteers Needed:</strong> ${event.volunteersNeeded}
                </div>
                <div class="back-btn">
                    <a href="javascript:history.back()">Back to Events</a>
                </div>
                    ${userId ? renderLoggedInButtons(event) : renderLoggedOutButtons()}
                `;
            } catch (error) {
                console.error('Error fetching event details:', error);
            }
        }

        // Function to render buttons when user is logged in
        function renderLoggedInButtons(event) {
            const eventRoles = event.eventRoles || [];
            const rolesHtml = eventRoles.map(role => `<div class="event-role">${role.roleName}: ${role.roleDescription}</div>`).join('');
            return `
                <div class="event-roles">
                    <h2>Event Roles:</h2>
                    ${rolesHtml}
                </div>
                <div class="register-btn">
                    <button onclick="redirectToIndex()">Register</button>
                </div>
                <div class="back-btn">
                    <a href="javascript:history.back()">Back to Events</a>
                </div>
            `;
        }


        // Function to render buttons when user is not logged in
        function renderLoggedOutButtons() {
            return `
                <div class="register-btn">
                    <button onclick="redirectToIndex()">Register</button>
                </div>
                <div class="back-btn">
                    <a href="javascript:history.back()">Back to Events</a>
                </div>
            `;
        }

        //function to proceed to register page (function name is different temporarily, will change when register page works)
        function redirectToIndex() {
            window.location.href = "./index.html";
        }

        function redirectToRegister() {
            window.location.href = "./index.html";
        }


        // Call the fetchAndDisplayEventDetails function with the eventId parameter
        const urlParams = new URLSearchParams(window.location.search);
        const eventId = urlParams.get('eventId');
        fetchAndDisplayEventDetails(eventId);
        window.onload = fetchAndDisplayEventDetails;
    </script>
</body>
</html>